      - name: Start services
        env:
          INVENTORY_DB: ${{ env.INVENTORY_DB }}
          PROCUREMENT_DB: ${{ env.PROCUREMENT_DB }}
          JWT_SECRET: ${{ env.JWT_SECRET }}
          INVENTORY_URL: http://localhost:4001
          PROCUREMENT_URL: http://localhost:4002
        run: |
          # 1) start inventory + procurement
          export PORT=4001 DATABASE_URL="$INVENTORY_DB"
          node inventory-svc/src/server.js > inv.log 2>&1 &

          export PORT=4002 DATABASE_URL="$PROCUREMENT_DB"
          node procurement-svc/src/server.js > proc.log 2>&1 &

          # 2) wait for both backends to be healthy
          npx wait-on -t 60000 http://localhost:4001/health http://localhost:4002/health

          # 3) start gateway AFTER the backends are up
          export PORT=8080 INVENTORY_URL="http://localhost:4001" PROCUREMENT_URL="http://localhost:4002" JWT_SECRET="$JWT_SECRET"
          node gateway/src/index.js > gw.log 2>&1 &

          # 4) now wait for the gateway
          npx wait-on -t 60000 http://localhost:8080/health

