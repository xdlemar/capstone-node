generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Project {
  id        BigInt   @id @default(autoincrement())
  name      String   @unique
  ownerId   BigInt?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  deliveries Delivery[]
}

model Delivery {
  id         BigInt    @id @default(autoincrement())
  projectId  BigInt
  supplierId BigInt?
  status     String    @default("PLANNED") // PLANNED | IN_TRANSIT | DELAYED | RECEIVED
  trackingNo String?
  eta        DateTime?
  cost       Decimal?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  project Project         @relation(fields: [projectId], references: [id], onDelete: Cascade)
  events  DeliveryEvent[]
  photos  DeliveryPhoto[]

  @@index([status, eta])
}

model DeliveryEvent {
  id         BigInt   @id @default(autoincrement())
  deliveryId BigInt
  status     String
  note       String?
  occurredAt DateTime @default(now())

  delivery Delivery @relation(fields: [deliveryId], references: [id], onDelete: Cascade)
}

model DeliveryPhoto {
  id         BigInt   @id @default(autoincrement())
  deliveryId BigInt
  fileKey    String // S3/local path
  createdAt  DateTime @default(now())

  delivery Delivery @relation(fields: [deliveryId], references: [id], onDelete: Cascade)
}
