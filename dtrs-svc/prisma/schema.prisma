generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Document {
  id        BigInt   @id @default(autoincrement())
  title     String
  projectId BigInt? // NOTE: separate microservice => store ID, no FK
  type      String? // DR | INVOICE | PO | POLICY | etc.
  createdAt DateTime @default(now())

  versions DocumentVersion[]
  acls     DocumentACL[]
  audits   DocumentAudit[]
}

model DocumentVersion {
  id         BigInt   @id @default(autoincrement())
  documentId BigInt
  versionNo  Int
  fileKey    String
  checksum   String
  createdAt  DateTime @default(now())

  document Document @relation(fields: [documentId], references: [id], onDelete: Cascade)

  @@unique([documentId, versionNo])
}

model DocumentACL {
  id         BigInt @id @default(autoincrement())
  documentId BigInt
  principal  String // user:id or role:name
  role       String // VIEW | EDIT | OWNER

  document Document @relation(fields: [documentId], references: [id], onDelete: Cascade)

  @@index([principal])
}

model DocumentAudit {
  id         BigInt   @id @default(autoincrement())
  documentId BigInt
  userId     BigInt?
  action     String // VIEW | UPLOAD | DELETE | SHARE | DOWNLOAD
  at         DateTime @default(now())

  document Document @relation(fields: [documentId], references: [id], onDelete: Cascade)
}
